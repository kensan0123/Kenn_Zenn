---
title: "Python logging の root logger と子 logger の階層関係を実践的に理解する"
emoji: "🐍"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Python"]
published: true
---

## 導入
Python の logging ライブラリは、アプリケーションの観測性を高めるうえで不可欠です。本記事では、root logger と子 logger の関係を明確に理解し、実務での適切な使い方をコード例とともに解説します。

## 背景
ロギングの階層構造の基本を押さえます。
- root logger はツリーの最上位にあり、デフォルトのハンドラを通じて出力を統制します。
- 名前にドットを使った階層名を付けると、自動的に親子関係が形成されます。
- propagate フラグが True の場合、子ロガーのイベントは親ロガーへ伝搬します。親ロガーがハンドラを持っている場合、そのハンドラにも出力されます。
- ロガーには level があり、NOTSET の場合は親のレベルを継承します。基本的な設定は root ロガーに対して行うことが多く、basicConfig は root に一括適用されます。

## 手順
### 1) 簡単な階層の例と挙動
```python
import logging

# ルートの設定。これが最初のハンドラとなる
logging.basicConfig(level=logging.INFO, format='%(name)s - %(levelname)s - %(message)s')

# 子ロガーを作成
root = logging.getLogger()
child = logging.getLogger('myapp.module')

child.info('これはルートのハンドラに伝搬します')
```

### 2) 子ロガーに個別のハンドラを追加して独立動作を作る
```python
child_handler = logging.StreamHandler()
child_handler.setFormatter(logging.Formatter('%(name)s - %(levelname)s - %(message)s'))
child.addHandler(child_handler)

child.info('このメッセージは子のハンドラからも出力されますが、root のハンドラにも出力されます')
```

### 3) propagate = False のケース
```python
child.propagate = False
child.info('このメッセージは root には伝搬せず、子のハンドラだけに出力されます')
```

### 4) dictConfig での設定例
```python
config = {
    'version': 1,
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
            'formatter': 'simple',
            'level': 'INFO'
        }
    },
    'formatters': {
        'simple': {'format': '%(name)s - %(levelname)s - %(message)s'}
    },
    'root': {'handlers': ['console'], 'level': 'INFO'}
}
import logging.config
logging.config.dictConfig(config)
logging.getLogger('example.module').info('dictConfig での設定が適用されます')
```

### 5) 実務での運用のコツ
- すべてのモジュールで logger を直接作成する習慣をつける（例: logger = logging.getLogger(__name__)）
- root の設定は控えめにし、モジュールごとに適切なレベルとハンドラを割り当てる
- 複数の出力先を必要とする場合は、適切にハンドラを組み合わせる（StreamHandler, FileHandler, SysLogHandler など）
- dictConfig などの外部設定で運用性を高める

## まとめ
- root logger と子 logger の関係を理解することで、ログの出力場所と重複を抑えられます。
- propagate の理解と NOTSET の継承挙動を把握しておくと、想定外のログ漏れを防げます。
- 実務では logger = logging.getLogger(__name__) を基本とし、設定ファイルで運用性を高めるのが有効です。

この記事はAIによって作成されました。
